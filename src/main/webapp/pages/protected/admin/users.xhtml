<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/template/template.xhtml">

    <ui:define name="title">Users</ui:define>
    <ui:define name="pageTitle">Users</ui:define>

    <ui:define name="content">
        <h:head>
            <style>
                .background {
                    height: 100%;
                }

                .first-layer-top {
                    display: inline-flex;
                    justify-content: space-between;

                }

                ul.navList{
                    display: flex;
                    justify-content: center;
                }

                .navListItem{
                    margin-left: 3rem;
                }

                div.btn-sect{
                }

                .second-layer-top {
                    display: inline-flex;
                    justify-content: space-between;
                    width: calc(100% - 25px);
                    align-items: center;
                }

                input#searchForm\:search.ui-inputfield {
                    width: 840px !important;
                }

                form#regform {
                    display: flex;
                    column-gap: 25px;
                }

                .topOfTable {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding-bottom: .5em;
                }


            </style>
        </h:head>

        <div class="first-layer-top">
            <h:form>
                <ul class="navList">
                    <li class="">
                        <h:commandLink styleClass="listLink" action="#{navigationBean.changeUserSection('usersSection')}">
                            <h:outputText value="Users" />
                            <p:ajax update="contentSection" />
                        </h:commandLink>
                    </li>
                    <li class="navListItem">
                        <h:commandLink styleClass="listLink" action="#{navigationBean.changeUserSection('roles')}">
                            <h:outputText value="User Roles" />
                            <p:ajax update="contentSection" />
                        </h:commandLink>
                    </li>
                </ul>
            </h:form>

            <div class="btn-sect">

                <h:form class="actns" id="regform">
                    <p:commandButton oncomplete="PF('dlg').show();" process="@this" update="dlg" styleClass="btn1"
                                     icon="pi pi-user-plus"
                                     value="Add New"/>

                    <p:commandButton oncomplete="PF('role').show();" process="@this" update="dlg" styleClass="btn1"
                                     icon="pi pi-user-plus"
                                     value="Add Role"/>

                    <p:dialog header="Add User" widgetVar="dlg" modal="true" id="dlg" responsive="true" dynamic="true" resizable="false" width="600">
                        <h:panelGrid>
                            <h:outputLabel for="u_n" value="User Name:"/>
                            <p:inputText id="u_n" value="#{userBean.username}" required="true"
                                         requiredMessage="Username is required!">
<!--                                <f:validator validatorId="usernameValidator"/>-->
<!--                                <f:ajax event="keyup" execute="@this" render="usernameMessage"/>-->
                            </p:inputText>


                            <h:outputLabel for="f_n" value="First Name:"/>
                            <p:inputText id="f_n" value="#{userBean.firstname}" required="true"
                                         requiredMessage="First name is required!">
<!--                                <f:validator validatorId="nameValidator"/>-->
<!--                                <f:ajax event="keyup" execute="@this" render="firstnameMessage"/>-->
                            </p:inputText>


                            <h:outputLabel for="l_n" value="Last Name:"/>
                            <p:inputText id="l_n" value="#{userBean.lastname}" required="true"
                                         requiredMessage="Last name is required!">
<!--                                <f:validator validatorId="nameValidator"/>-->
<!--                                <f:ajax event="keyup" execute="@this" render="lastnameMessage"/>-->
                            </p:inputText>


                            <h:outputLabel for="password1" value="Password:"/>
                            <p:password id="password1" value="#{userBean.password1}" required="true"
                                        feedback="true"
                                        requiredMessage="Password is required!">
<!--                                <f:validator validatorId="emailValidator"/>-->
<!--                                <f:ajax event="keyup" execute="@this" render="emailMessage"/>-->
                            </p:password>

                            <h:outputLabel for="password2" value="Confirm:"/>
                            <p:password id="password2" value="#{userBean.password2}" required="true"
                                        feedback="true"
                                        requiredMessage="Please confirm password!">
                                <!--                                <f:validator validatorId="emailValidator"/>-->
                                <!--                                <f:ajax event="keyup" execute="@this" render="emailMessage"/>-->
                            </p:password>

                            <h:outputLabel for="u_email" value="Email:"/>
                            <p:inputText id="u_email" value="#{userBean.email}" required="true"
                                         requiredMessage="Email is required!">
                                <!--                                <f:validator validatorId="emailValidator"/>-->
                                <!--                                <f:ajax event="keyup" execute="@this" render="emailMessage"/>-->
                            </p:inputText>

                            <h:outputLabel for="role_" value="Role:"/>
                            <p:selectOneMenu id="role_" value="#{userBean.role}" required="true"
                                             requiredMessage="Role is required!">
                                <f:selectItem itemLabel="Select a role" itemValue="" noSelectionOption="true"/>
                                <f:selectItems value="#{roleBean.getRoles()}" var="role"
                                               itemLabel="#{role.name}" itemValue="#{role.name}"/>
                            </p:selectOneMenu>

                        </h:panelGrid>

                        <p:commandButton value="Add"
                                         process="@form"
                                         action="#{userBean.saveUser(userBean.firstname,userBean.lastname,userBean.username,userBean.password1,userBean.password2,userBean.email,userBean.role)}"
                                         oncomplete=" if (!(PF('dlg').jq.find('.ui-messages-error').length == 0)) PF('dlg').show();"
                                         update=":userForm:userTable"
                                            />
                    </p:dialog>


                    <p:commandButton  action="#{userBean.deleteAllUsers()}" styleClass="ui-button-danger mr-2"
                                      icon="pi pi-user-minus" value="Delete All"
                                      update=":userForm:userTable"/>

                </h:form>

                <h:form>
                    <p:dialog header="Add Role" widgetVar="role" modal="true" id="role" responsive="true" dynamic="true" resizable="false" width="600">

                        <h:panelGrid>
                            <h:outputLabel for="role_name" value="Role Name:"/>
                            <p:inputText id="role_name" value="#{roleBean.name}" required="true"
                                         requiredMessage="Role name is required!">
                                <!--                                <f:validator validatorId="usernameValidator"/>-->
                                <!--                                <f:ajax event="keyup" execute="@this" render="usernameMessage"/>-->
                            </p:inputText>
                            <h:outputLabel for="role_p" value="Permissions:"/>
                            <p:selectManyCheckbox id="role_p" value="#{roleBean.selectedPermissions}" required="true"
                                                  requiredMessage="At least one role is required!">
                                <f:selectItems value="#{roleBean.permissions()}" var="permission"
                                               itemLabel="#{permission}" itemValue="#{permission}"/>
                            </p:selectManyCheckbox>

                        </h:panelGrid>

                        <p:commandButton value="Add"
                                         process="@form"
                                         action="#{roleBean.saveRole(roleBean.name,roleBean.selectedPermissions)}"
                                         oncomplete=" if (!(PF('role').jq.find('.ui-messages-error').length == 0)) PF('role').show();"
                                         update=":userForm:userTable"

                        />
                    </p:dialog>
                </h:form>



            </div>
        </div>

        <h:panelGroup id="contentSection">
            <ui:include src="#{navigationBean.selectedUserSection}.xhtml" />
        </h:panelGroup>

    </ui:define>

</ui:composition>